---
title: "Git Rebase - å˜åŸºæ“ä½œè¯¦è§£"
description: "æ·±å…¥ç†è§£ git rebaseï¼Œå­¦ä¹ å¦‚ä½•æ•´ç†æäº¤å†å²ï¼Œä»¥åŠ rebase ä¸ merge çš„åŒºåˆ«"
category: "advanced"
level: "è¿›é˜¶"
duration: "25 åˆ†é’Ÿ"
tags: ["rebase", "å˜åŸº", "å†å²æ•´ç†"]
date: "2024-01-10"
---

## ç®€ä»‹

`git rebase` æ˜¯ Git ä¸­æœ€å¼ºå¤§ä½†ä¹Ÿæœ€å®¹æ˜“è¯¯ç”¨çš„å‘½ä»¤ä¹‹ä¸€ã€‚å®ƒå¯ä»¥ï¼š

- ğŸ“ æ•´ç†æäº¤å†å²
- ğŸ§¹ æ¸…ç†æ··ä¹±çš„æäº¤è®°å½•
- ğŸ”€ åˆ›å»ºçº¿æ€§çš„é¡¹ç›®å†å²
- âœ¨ è®©å†å²æ›´æ˜“è¯»

ä½†è¦å°å¿ƒä½¿ç”¨ï¼

## Rebase vs Merge

### Merge çš„æ–¹å¼

```
main:    A --- B --- C --- D
              â†‘           â†—
feature:      â””â”€ E --- F
```

åˆå¹¶åï¼š

```
main:    A --- B --- C --- D --- M
              â†‘           â†—     â†—
feature:      â””â”€ E ----- F ----â”˜
```

**ç‰¹ç‚¹**ï¼šä¿ç•™å®Œæ•´å†å²ï¼Œæœ‰åˆå¹¶æäº¤

### Rebase çš„æ–¹å¼

```
main:    A --- B --- C --- D
              â†‘
feature:      â””â”€ E --- F
```

Rebase åï¼š

```
main:    A --- B --- C --- D
                            â†–
feature:                     E' --- F'
```

**ç‰¹ç‚¹**ï¼šçº¿æ€§å†å²ï¼Œæ²¡æœ‰åˆå¹¶æäº¤

## åŸºæœ¬ Rebase

### å°† feature åˆ†æ”¯ rebase åˆ° main

```bash
# åœ¨ feature åˆ†æ”¯ä¸Š
git checkout feature
git rebase main
```

è¿™ä¼šï¼š
1. æ‰¾åˆ°å…±åŒç¥–å…ˆ
2. å–å‡º feature çš„æ‰€æœ‰æäº¤
3. å°†å®ƒä»¬ä¸€ä¸ªä¸ªåº”ç”¨åˆ° main æœ€æ–°æäº¤ä¹‹å

### è§£å†³å†²çª

å¦‚æœé‡åˆ°å†²çªï¼š

```bash
# 1. è§£å†³å†²çª
# ç¼–è¾‘å†²çªæ–‡ä»¶

# 2. æ ‡è®°ä¸ºå·²è§£å†³
git add conflicted-file.txt

# 3. ç»§ç»­ rebase
git rebase --continue
```

æ”¾å¼ƒ rebaseï¼š

```bash
git rebase --abort
```

## äº¤äº’å¼ Rebase

æœ€å¼ºå¤§çš„åŠŸèƒ½ï¼å¯ä»¥ä¿®æ”¹å†å²æäº¤ã€‚

```bash
git rebase -i HEAD~3
```

ä¼šæ‰“å¼€ç¼–è¾‘å™¨ï¼š

```
pick f7f3f6d æäº¤1
pick 310154e æäº¤2
pick a5f4a0d æäº¤3

# Commands:
# p, pick = ä½¿ç”¨æäº¤
# r, reword = ä½¿ç”¨æäº¤ï¼Œä½†ä¿®æ”¹æäº¤ä¿¡æ¯
# e, edit = ä½¿ç”¨æäº¤ï¼Œä½†åœä¸‹æ¥ä¿®æ”¹
# s, squash = ä½¿ç”¨æäº¤ï¼Œä½†åˆå¹¶åˆ°å‰ä¸€ä¸ªæäº¤
# f, fixup = ç±»ä¼¼ squashï¼Œä½†ä¸¢å¼ƒæäº¤ä¿¡æ¯
# d, drop = åˆ é™¤æäº¤
```

### å¸¸ç”¨æ“ä½œ

#### 1. åˆå¹¶å¤šä¸ªæäº¤

```
pick f7f3f6d æ·»åŠ åŠŸèƒ½A
squash 310154e ä¿®å¤åŠŸèƒ½Açš„bug
squash a5f4a0d å®Œå–„åŠŸèƒ½A
```

ä¸‰ä¸ªæäº¤ä¼šåˆå¹¶æˆä¸€ä¸ªã€‚

#### 2. ä¿®æ”¹æäº¤ä¿¡æ¯

```
pick f7f3f6d æ—§çš„æäº¤ä¿¡æ¯
reword 310154e éœ€è¦æ”¹çš„æäº¤
pick a5f4a0d å¦ä¸€ä¸ªæäº¤
```

#### 3. é‡æ–°æ’åºæäº¤

```
pick a5f4a0d æäº¤3
pick f7f3f6d æäº¤1
pick 310154e æäº¤2
```

#### 4. åˆ é™¤æäº¤

```
pick f7f3f6d ä¿ç•™çš„æäº¤
drop 310154e è¦åˆ é™¤çš„æäº¤
pick a5f4a0d ä¿ç•™çš„æäº¤
```

## é»„é‡‘æ³•åˆ™

âš ï¸ **æ°¸è¿œä¸è¦ rebase å·²ç»æ¨é€åˆ°å…¬å…±åˆ†æ”¯çš„æäº¤ï¼**

**åŸå› **ï¼š
- Rebase ä¼šæ”¹å˜æäº¤çš„ SHA-1
- å…¶ä»–äººçš„å·¥ä½œä¼šå—å½±å“
- ä¼šå¯¼è‡´æ··ä¹±å’Œå†²çª

**å®‰å…¨ä½¿ç”¨**ï¼š
- âœ… è‡ªå·±çš„æœ¬åœ°åˆ†æ”¯
- âœ… è¿˜æ²¡æ¨é€çš„æäº¤
- âœ… ä¸ªäººçš„ feature åˆ†æ”¯
- âŒ main/master åˆ†æ”¯
- âŒ å·²æ¨é€çš„å…¬å…±åˆ†æ”¯
- âŒ å…¶ä»–äººæ­£åœ¨ä½¿ç”¨çš„åˆ†æ”¯

## å®æˆ˜åœºæ™¯

### åœºæ™¯ 1: æ•´ç†æœ¬åœ°æäº¤

```bash
# ä½ æœ‰ 5 ä¸ªæ··ä¹±çš„æäº¤
git log --oneline
# a1b2c3d ä¿®å¤æ‹¼å†™é”™è¯¯
# d4e5f6g æ·»åŠ åŠŸèƒ½
# g7h8i9j åˆä¿®å¤äº†ä¸ªbug
# j0k1l2m å®Œå–„åŠŸèƒ½
# m3n4o5p WIP

# äº¤äº’å¼ rebase
git rebase -i HEAD~5

# æ•´ç†æˆæ¸…æ™°çš„æäº¤
pick d4e5f6g æ·»åŠ åŠŸèƒ½
squash j0k1l2m å®Œå–„åŠŸèƒ½
drop m3n4o5p WIP
fixup g7h8i9j åˆä¿®å¤äº†ä¸ªbug
fixup a1b2c3d ä¿®å¤æ‹¼å†™é”™è¯¯
```

### åœºæ™¯ 2: è®© PR ä¿æŒæœ€æ–°

```bash
# ä½ çš„ feature åˆ†æ”¯è½åäº†
git checkout feature
git fetch origin
git rebase origin/main

# è§£å†³å†²çªï¼ˆå¦‚æœæœ‰ï¼‰
# ...

# å¼ºåˆ¶æ¨é€ï¼ˆå› ä¸ºæ”¹å˜äº†å†å²ï¼‰
git push --force-with-lease
```

`--force-with-lease` æ¯” `--force` æ›´å®‰å…¨ï¼Œå¦‚æœè¿œç¨‹æœ‰ä½ ä¸çŸ¥é“çš„æäº¤ä¼šæ‹’ç»æ¨é€ã€‚

### åœºæ™¯ 3: ä¿®æ”¹å†å²ä¸­çš„æŸä¸ªæäº¤

```bash
# æ‰¾åˆ°è¦ä¿®æ”¹çš„æäº¤
git log --oneline

# äº¤äº’å¼ rebase
git rebase -i abc123^

# æ ‡è®°ä¸º edit
edit abc123 è¦ä¿®æ”¹çš„æäº¤
pick def456 åç»­æäº¤

# Git ä¼šåœåœ¨é‚£ä¸ªæäº¤
# åšä½ çš„ä¿®æ”¹
git add modified-file.txt
git commit --amend

# ç»§ç»­
git rebase --continue
```

## Rebase vs Mergeï¼šä½•æ—¶ä½¿ç”¨ï¼Ÿ

### ä½¿ç”¨ Merge

- âœ… åˆå¹¶å…¬å…±åˆ†æ”¯
- âœ… ä¿ç•™å®Œæ•´å†å²
- âœ… å›¢é˜Ÿåä½œçš„ä¸»åˆ†æ”¯
- âœ… å‘å¸ƒåˆ†æ”¯

### ä½¿ç”¨ Rebase

- âœ… æ•´ç†ä¸ªäººåˆ†æ”¯
- âœ… è®©å†å²æ›´æ¸…æ™°
- âœ… åŒæ­¥è¿œç¨‹æ›´æ–°
- âœ… å‡†å¤‡ PR å‰æ•´ç†æäº¤

### æ¨èå·¥ä½œæµ

```bash
# å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ rebase ä¸»åˆ†æ”¯
git checkout feature
git rebase main

# å¼€å‘å®Œæˆï¼Œæ•´ç†æäº¤
git rebase -i main

# åˆå¹¶åˆ°ä¸»åˆ†æ”¯æ—¶ç”¨ merge
git checkout main
git merge feature
```

## å¸¸è§é—®é¢˜

### Q1: Rebase ä¸­æ–­äº†ï¼Œä¸çŸ¥é“æ€ä¹ˆåŠï¼Ÿ

```bash
# æŸ¥çœ‹çŠ¶æ€
git status

# æ”¾å¼ƒ rebase
git rebase --abort

# æˆ–è§£å†³å†²çªåç»§ç»­
git add .
git rebase --continue
```

### Q2: ä¸å°å¿ƒ rebase äº†å…¬å…±åˆ†æ”¯ï¼Ÿ

```bash
# æ‰¾å›åŸæ¥çš„æäº¤
git reflog
git reset --hard HEAD@{n}
```

### Q3: Rebase åæ¨é€è¢«æ‹’ç»ï¼Ÿ

```bash
# ä½¿ç”¨ force-with-lease
git push --force-with-lease
```

## å°ç»“

- **Rebase**: é‡æ–°åº”ç”¨æäº¤ï¼Œåˆ›å»ºçº¿æ€§å†å²
- **äº¤äº’å¼ Rebase**: æ•´ç†ã€åˆå¹¶ã€ä¿®æ”¹æäº¤
- **é»„é‡‘æ³•åˆ™**: ä¸è¦ rebase å…¬å…±åˆ†æ”¯
- **vs Merge**: Rebase æ›´æ¸…æ™°ï¼ŒMerge æ›´å®‰å…¨
- **å·¥ä½œæµ**: æœ¬åœ°ç”¨ rebaseï¼Œå…¬å…±ç”¨ merge

å¼ºå¤§ä½†éœ€è°¨æ…ä½¿ç”¨ï¼
